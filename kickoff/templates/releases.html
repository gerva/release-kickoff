{% extends "base.html" %}
{% block content %}
<ul id='errors'>
    {% for e in errors %}
    <li class='error'>{{ e }}</li>
    {% endfor %}
</ul>
 <script type="text/javascript">
        $(document).ready(function() {
            $('#btnChangeView').click(function() {
                //$('td:nth-child(2)').hide();
                // if your table has header(th), use this
                $('td:nth-child(11),th:nth-child(11)').toggle();
                $('td:nth-child(6),th:nth-child(6)').toggle();
            });
        });
 </script>
<h2 class="title">Releases:</h2>
<input id="btnChangeView" type="button" value="Change view"/>
<form id='release_readyness' action='{{ url_for('releases') }}' method='post'>
{{ form.hidden_tag() }}
<table id="releases">
<tr>
<!--  1 --><th>Name</th>
<!--  2 --><th>Submitted By</th>
<!--  3 --><th>Submitted At</th>
<!--  4 --><th>Branch</th>
<!--  5 --><th>Mozilla Revision</th>
<!--  6 --><th>Mozilla Relbranch</th>
<!--  7 --><th>Comm Revision</th>
<!--  8 --><th>Comm Relbranch</th>
<!--  9 --><th>Check Dashboard?</th>
<!-- 10 --><th>L10n Changesets</th>
<!-- 11 --><th>Partial Versions</th>
<!-- 12 --><th>Update Prompt Wait Time</th>
<!-- 13 --><th>Ready?</th>
<!-- 14 --><th>Status</th>
<!-- 15 --><th>Delete?</th>
</tr>
{% for rel in releases %}
{% if not rel.ready %}
<tr class='notready'>
{% elif not rel.complete %}
<tr class='incomplete'>
{% else %}
<tr class='complete'>
{% endif %}
    {% if not rel.ready %}
        <td><a href="/release.html?name={{ rel.name }}">{{ rel.name }}</a></td>
    {% else %}
        <td>{{ rel.name }}</td>
    {% endif %}
    <td>{{ rel.submitter }}</td>
    <td id='{{ rel.name }}_submittedAt'>
        <script type='text/javascript'>
            document.addEventListener('readystatechange', function() {
                if (document.readyState == 'complete') {
                    localdate = new Date('{{ rel.submittedAt }}');
                    var e = document.getElementById('{{ rel.name }}_submittedAt');
                    e.textContent = localdate.toLocaleString();
                }
            })
        </script>
    </td>
    <td>{{ rel.branch }}</td>
    <td>{{ rel.mozillaRevision }}</td>
    <td>{{ rel.mozillaRelbranch }}</td>
    {% if 'Thunderbird' in rel.name %}
        <td>{{ rel.commRevision }}</td>
        <td>{{ rel.commRelbranch }}</td>
    {% else %}
        <td class="irrelevant">N/A</td>
        <td class="irrelevant">N/A</td>
    {% endif %}
    {% if rel.dashboardCheck %}
        <td>Yes</td>
    {% else %}
        <td>No</td>
    {% endif %}
    <td><a href="/releases/{{ rel.name }}/l10n">Link</a></td>
    {% if 'Fennec' in rel.name %}
        <td class="irrelevant">N/A</td>
    {% else %}
        <td>{{ rel.partials }}</td>
    {% endif %}
    {% if 'Fennec' in rel.name %}
        <td class="irrelevant">N/A</td>
    {% else %}
        {% if not rel.promptWaitTime %}
            <td>Default</td>
        {% else %}
            <td>{{ rel.promptWaitTime }}</td>
        {% endif %}
    {% endif %}
    <td>
    {% if rel.ready %}
        <input id='readyReleases_{{ rel.name }}' type='checkbox' name='readyReleases' value='{{ rel.name }}' checked='checked' disabled='disabled' />
    {% else %}
        <input id='readyReleases_{{ rel.name }}' type='checkbox' name='readyReleases' value='{{ rel.name }}' />
    {% endif %}
    </td>
    <td>{{ rel.status }}</td>
    <td>
    {% if not rel.complete and not rel.ready %}
        <input id='deleteReleases_{{ rel.name }}' type='checkbox' name='deleteReleases' value='{{ rel.name }}' onclick='disableReady("{{ rel.name }}")' />
    {% else %}
        <input type='checkbox' name='deleteReleases' value='{{ rel.name }}' disabled='disabled' />
    {% endif %}
    </td>
{% endfor %}
</table>
<input type='submit' value='Do eet!' />
</form>

<script type='text/javascript'>
function disableReady(release) {
    readyCheckbox = document.getElementById('readyReleases_' + release);
    deleteCheckbox = document.getElementById('deleteReleases_' + release);
    if (deleteCheckbox.checked) {
        readyCheckbox.checked = false;
        readyCheckbox.disabled = true;
    }
    else {
        readyCheckbox.disabled = false;
    }
}
</script>
{% endblock %}
